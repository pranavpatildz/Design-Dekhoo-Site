<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/modal.css"> <!-- Link to modal CSS -->
</head>
<body class="login-page">

    <div class="login-container">
        <div class="login-art">
            <img src="/images/hero.jpg" alt="Artisan furniture">
        </div>
        <div class="form-container">
            <div class="form-wrapper">
                <div class="form-header">
                    <a href="/" class="logo">DesignDekhoo</a>
                    <h2>Forgot Your Password?</h2>
                    <p>Enter your email address and we'll send you a reset link.</p>
                </div>

                <form id="forgot-password-form" action="/api/auth/forgot-password" method="POST">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="you@example.com" required>
                    </div>
                    <button type="submit" class="btn-submit">Send Reset Link</button>
                    <div class="form-options">
                        <a href="/login">Back to Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Forgot Password Success Modal -->
    <div id="forgotPasswordSuccessModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-icon">ðŸ“©</div>
            <h3 class="modal-title">Reset Link Sent!</h3>
            <p class="modal-message">If an account with that email exists, a reset link has been sent.</p>
            <button class="modal-button go-to-login" id="forgotPasswordModalOkBtn">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('forgot-password-form');
            const modal = document.getElementById('forgotPasswordSuccessModal');
            const okBtn = document.getElementById('forgotPasswordModalOkBtn');

            function closeModal() {
                modal.classList.remove('show');
            }

            if (okBtn) {
                okBtn.addEventListener('click', closeModal);
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent default form submission

                const email = document.getElementById('email').value;

                try {
                    const response = await fetch('/api/auth/forgot-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email }),
                    });

                    if (response.ok) {
                        modal.classList.add('show'); // Show success modal
                    } else {
                        const errorData = await response.json();
                        alert('Error: ' + (errorData.msg || 'Something went wrong.'));
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                    alert('An unexpected error occurred. Please try again.');
                }
            });
        });
    </script>
</body>
</html>
